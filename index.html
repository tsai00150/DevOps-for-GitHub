<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=10"> 
  </head>
  <body>
    <div class="container mt-3" style="width: 400px;" title="A Google Chrome extension that can visualize DevOps evaluation metrics">
        <h1 class="text-center">DevOps Metrics</h1>
    </div>
    <div title="The owner of the repository">
      owner: <span id="owner"></span>
    </div>
    <div style="width: 5px; height: 5px;"></div>
    <div title="The name of the repository">
      repo: <span id="repo"></span>
    </div>
  
    <div class="container mt-3" style="width: 400px;" title="Deployment Frequency: The deployment and release count within a time frame.">
        <h2 class="text-center">Deployment frequency</h2>
    </div>

    <div id="myChart11" style="width: 400px; height: 250px"></div>

    <div class="container mt-3" style="width: 400px;" title="Deployments per Release: The Deployments per Release ratio within a time frame.">
      <h2 class="text-center">Deployments Per Release</h2>
    </div>

    <div id="myChart12" style="width: 400px; height: 250px"></div>

    <div style="width: 25px; height: 25px;"></div>



    <div class="container mt-3" style="width: 400px;" title="Number of issues here refers to the software defects observed from the user side. The third metric, number of successful deployments, is trying to mimic the metric “number of software roll back” proposed in papers, as we view it as being automatically “rolled back” by the CI pipeline. While not exactly following the research papers due to API limitations, this should give a sense of the defect densities for repository to newcomers.">
        <h2 class="text-center">Defect Density</h2>
    </div>

    <div title="metric1 = number of issues / number of deployments">
      <span style="font-weight: bold;" id="metric1Name"></span> 
      <span id="metric1Value"></span>
    </div>
    <div style="width: 5px; height: 5px;"></div>
    <div title="metric2 = number of issues / number of sucessful deployments">
      <span style="font-weight: bold;" id="metric2Name"></span> 
      <span id="metric2Value"></span>
    </div>
    <div style="width: 5px; height: 5px;"></div>
    <div title="metric3 = number of successful deployments / number of deployments">
      <span style="font-weight: bold;" id="metric3Name"></span> 
      <span id="metric3Value"></span>
    </div>

    <div class="container mt-3" style="width: 400px;" title="The time unit on x-axis should be week, month, year, cycle, but for demo purposes, I think time unit = day is better (should save some development time)
    For y-axis, we can have the following:
    Failure / total
    Error / total
    Failure+Error / total">
      <h2 class="text-center">Advanced Defect Density(Test Cases)</h2>
    </div>
    <div style="width: 5px; height: 15px;"></div>
    <div id="myChart21" style="width: 400px; height: 250px"></div>
    

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="module">
      import { drawChart } from './scripts/popup.js'
      drawChart();
    </script>
    
    <script type="text/javascript" src="/scripts/jszip.min.js"></script>
    <script type="module">
      import { getUnitTest } from './scripts/action.js'; 
      getUnitTest('tsai00150', 'devops-user-study', ['devops-user-study'], 'build (3.9)', 4, 'Test with unittest')
          .then(result => {
            // console.log(result);

            google.charts.load('current', {'packages':['bar']});

            google.charts.setOnLoadCallback(drawChart);

            function drawChart() {
                  
              let dataSource = [['Date', 'Failure / total' , 'Error / total', 'Failure+Error / total']]
              
              for (let input of result){
                const dateAndTime = input[3].split('T');
                const dateList = dateAndTime[0].split('-');
                const timeList = dateAndTime[1].split(':');
                const toShow = dateList[1]+'/'+dateList[2]+' '+timeList[0]+':'+timeList[1];

                const total = input[0]+input[1]+input[2];
                const FaE = input[1]+input[2];
                dataSource.push([toShow, input[1]/total, input[2]/total, FaE/total]);

              }

              console.log(dataSource)
              var data = google.visualization.arrayToDataTable(dataSource);

              var options = {
                chart: {
                  title: '',
                  subtitle: '',
                },
                bars: 'vertical',
                legend: {position: 'none'} 
              };

              var chart = new google.charts.Bar(document.getElementById('myChart21'));

              chart.draw(data, google.charts.Bar.convertOptions(options));
            }


          });


          // google.charts.load('current', {'packages':['bar']});
          
          // var rawData = [
          //         [4, 4, 2, '2023-03-01T18:42:43Z'],
          //         [4, 3, 3, '2023-03-01T18:40:37Z'],
          //         [4, 3, 2, '2023-03-01T18:37:58Z'],
          //         [4, 2, 3, '2023-03-01T18:36:14Z'],
          //         [2, 4, 3, '2023-03-01T18:35:27Z'],
          //         [2, 0, 0, '2023-03-01T18:26:51Z'],
          //         [8, 1, 0, '2023-02-28T18:30:17Z'],
          //         [4, 4, 1, '2023-02-28T18:26:20Z'],
          //         [6, 0, 1, '2023-02-27T17:38:13Z'],
          //         [6, 1, 0, '2023-02-27T17:30:58Z'],
          //         [2, 0, 0, '2023-02-27T17:24:02Z'],
          //         [2, 0, 0, '2023-02-26T18:34:55Z'],
          //         [1, 1, 0, '2023-02-26T18:32:36Z']
          //       ];

          // google.charts.setOnLoadCallback(drawChart);

          // function drawChart() {
                
          //   let dataSource = [['Date', 'Failure / total' , 'Error / total', 'Failure+Error / total']]
            
          //   for (let input of rawData){
          //     const dateAndTime = input[3].split('T');
          //     const dateList = dateAndTime[0].split('-');
          //     const timeList = dateAndTime[1].split(':');
          //     const toShow = dateList[1]+'/'+dateList[2]+' '+timeList[0]+':'+timeList[1];

          //     const total = input[0]+input[1]+input[2];
          //     const FaE = input[1]+input[2];
          //     dataSource.push([toShow, input[1]/total, input[2]/total, FaE/total]);

          //   }

          //   console.log(dataSource)
          //   var data = google.visualization.arrayToDataTable(dataSource);

          //   var options = {
          //     chart: {
          //       title: 'Advanced Defect Density(Test Cases)',
          //       subtitle: '',
          //     },
          //     bars: 'vertical',
          //     legend: {position: 'none'} 
          //   };

          //   var chart = new google.charts.Bar(document.getElementById('myChart21'));

          //   chart.draw(data, google.charts.Bar.convertOptions(options));
          // }

      
    </script>    
  </body>
</html>
